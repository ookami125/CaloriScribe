<div class="ambient"></div>
{{{header}}}
<div class="ui-fill ui-scroll">
  <main class="page">
    <section class="panel">
      <div class="panel-header">
        <div>
          <h1>Food library</h1>
          <p>Track store-bought foods without adding them to recipes.</p>
        </div>
        <div class="panel-actions">
          <button class="primary" type="button" data-scan-trigger data-scan-target="food">Scan barcode</button>
        </div>
      </div>
      <div class="panel-body split">
        <form id="food-form" class="stacked-card">
          <h3 id="food-form-title">Add food</h3>
          <input id="food-id" type="hidden" name="id">
          <div class="grid two">
            <label>
              Name
              <input type="text" name="name" required>
            </label>
            <label>
              Barcode
              <div class="field-row">
                <input id="food-barcode-input" type="text" name="barcode">
                <button class="ghost" id="food-barcode-lookup" type="button">Lookup</button>
              </div>
            </label>
            <label>
              Unit (g, ml, tbsp, piece)
              <div class="field-row">
                <input type="text" name="unit" required>
                <button class="ghost" id="food-unit-change" type="button">Change</button>
              </div>
            </label>
            <label>
              Serving size (label)
              <input type="text" name="servingSize" placeholder="1 cup (240 ml)">
            </label>
            <label>
              Servings per container
              <input type="text" name="servingsPerContainer" placeholder="about 8">
            </label>
          </div>
          <div class="form-section">
            <h4>Nutrition facts per unit</h4>
            <div class="grid three">
              <label>
                Calories
                <input type="number" name="calories" step="0.01" required>
              </label>
              <label>
                Total fat (g)
                <input type="number" name="fat" step="0.01" required>
              </label>
              <label>
                Total carbs (g)
                <input type="number" name="carbs" step="0.01" required>
              </label>
              <label>
                Protein (g)
                <input type="number" name="protein" step="0.01" required>
              </label>
            </div>
            <div class="add-nutrient-row">
              <label>
                Additional facts
                <select id="food-extra-nutrient-select"></select>
              </label>
              <button class="ghost" id="add-food-nutrient" type="button">Add nutrient</button>
            </div>
            <div class="grid three" id="food-extra-nutrients"></div>
          </div>
          <label>
            Ingredients list
            <textarea name="ingredientsList" rows="3"></textarea>
          </label>
          <label>
            Other vitamins &amp; minerals
            <textarea name="vitamins" rows="2"></textarea>
          </label>
          <label>
            Allergens
            <textarea name="allergens" rows="2"></textarea>
          </label>
          <div class="form-actions">
            <button class="primary" id="food-submit" type="submit">Save food</button>
            <button class="ghost" id="food-cancel" type="button" hidden>Cancel edit</button>
          </div>
          <p class="form-status" id="food-status"></p>
        </form>
        <div>
          <div class="panel-tools">
            <input id="food-search" type="search" placeholder="Search foods">
          </div>
          <div class="list scroll" id="food-list"></div>
        </div>
      </div>
    </section>
  </main>
</div>

<div class="modal" id="scan-modal" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-header">
      <h3>Scan barcode</h3>
      <div class="modal-actions">
        <button class="icon-button" id="scan-upload-open" type="button" aria-label="Upload barcode image" title="Upload barcode image">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M12 16a1 1 0 0 1-1-1V7.41l-2.3 2.3a1 1 0 1 1-1.4-1.42l4.01-4.01a1 1 0 0 1 1.4 0l4.01 4.01a1 1 0 0 1-1.4 1.42L13 7.41V15a1 1 0 0 1-1 1z" fill="currentColor"/>
            <path d="M4 18a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2a1 1 0 1 0-2 0v2H6v-2a1 1 0 1 0-2 0v2z" fill="currentColor"/>
          </svg>
        </button>
        <button class="ghost" id="close-scan" type="button">Close</button>
      </div>
    </div>
    <div class="scan-area" id="scan-area">
      <video id="scan-video" autoplay playsinline></video>
      <div class="scan-target"></div>
    </div>
    <p class="form-status" id="scan-status"></p>
  </div>
</div>

<div class="modal" id="scan-upload-modal" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-header">
      <h3>Upload barcode</h3>
      <div class="modal-actions">
        <button class="icon-button" id="scan-upload-back" type="button" aria-label="Back to camera" title="Back to camera">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M9 7l1.4-2.1A2 2 0 0 1 12.1 4h1.8a2 2 0 0 1 1.7.9L17 7h1a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-6a3 3 0 0 1 3-3h3z" fill="currentColor"/>
            <path d="M12 17a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" fill="currentColor"/>
          </svg>
        </button>
        <button class="ghost" id="scan-upload-close" type="button">Close</button>
      </div>
    </div>
    <label class="file-input">
      Upload barcode image
      <input id="scan-image-input" type="file" accept="image/*">
    </label>
    <div class="scan-image-preview" id="scan-image-preview" hidden>
      <div class="scan-image-stage" id="scan-image-stage">
        <img id="scan-image" alt="Barcode preview">
        <div class="scan-target"></div>
      </div>
      <div class="scan-image-controls">
        <label class="field">
          Zoom
          <input id="scan-image-zoom" type="range" min="1" max="4" step="0.01" value="1">
        </label>
        <div class="scan-image-actions">
          <button class="ghost" id="scan-image-reset" type="button">Reset</button>
          <button class="primary" id="scan-image-scan" type="button">Scan image</button>
        </div>
      </div>
    </div>
    <p class="form-status" id="scan-upload-status"></p>
  </div>
</div>

{{{cardTemplates}}}
{{{confirmModal}}}
{{{unitChangeModal}}}

<script src="https://unpkg.com/@zxing/library@0.21.2/umd/index.min.js"></script>
<script src="/app.js"></script>
