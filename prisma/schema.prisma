generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Ingredient {
  id           Int                @id @default(autoincrement())
  name         String
  barcode      String?
  calories     Float
  protein      Float
  carbs        Float
  fat          Float
  unit         String
  servingSize         String?
  servingsPerContainer String?
  saturatedFat        Float?
  transFat            Float?
  cholesterolMg       Float?
  sodiumMg            Float?
  dietaryFiber        Float?
  totalSugars         Float?
  addedSugars         Float?
  vitaminDMcg         Float?
  calciumMg           Float?
  ironMg              Float?
  potassiumMg         Float?
  ingredientsList     String?
  vitamins            String?
  allergens           String?
  deletedAt    DateTime?
  userId       Int
  user         User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  recipeItems  RecipeIngredient[]
  logEntries   LogEntry[]

  @@index([userId])
  @@index([userId, deletedAt])
  @@unique([userId, barcode])
}

model Food {
  id           Int        @id @default(autoincrement())
  name         String
  barcode      String?
  calories     Float
  protein      Float
  carbs        Float
  fat          Float
  unit         String
  servingSize         String?
  servingsPerContainer String?
  saturatedFat        Float?
  transFat            Float?
  cholesterolMg       Float?
  sodiumMg            Float?
  dietaryFiber        Float?
  totalSugars         Float?
  addedSugars         Float?
  vitaminDMcg         Float?
  calciumMg           Float?
  ironMg              Float?
  potassiumMg         Float?
  ingredientsList     String?
  vitamins            String?
  allergens           String?
  deletedAt    DateTime?
  userId       Int
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  logEntries   LogEntry[]

  @@index([userId])
  @@index([userId, deletedAt])
  @@unique([userId, barcode])
}

model Recipe {
  id         Int                @id @default(autoincrement())
  name       String
  notes      String?
  servings   Int                @default(1)
  deletedAt  DateTime?
  userId     Int
  user       User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt
  items      RecipeIngredient[]
  logEntries LogEntry[]

  @@index([userId])
  @@index([userId, deletedAt])
}

model RecipeIngredient {
  id           Int        @id @default(autoincrement())
  recipeId     Int
  ingredientId Int
  quantity     Float
  unit         String
  recipe       Recipe     @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Restrict)
}

model LogEntry {
  id           Int        @id @default(autoincrement())
  consumedAt   DateTime   @default(now())
  quantity     Float
  unit         String
  ingredientId Int?
  foodId       Int?
  recipeId     Int?
  notes        String?
  userId       Int
  createdAt    DateTime   @default(now())
  ingredient   Ingredient? @relation(fields: [ingredientId], references: [id], onDelete: SetNull)
  food         Food?       @relation(fields: [foodId], references: [id], onDelete: SetNull)
  recipe       Recipe?     @relation(fields: [recipeId], references: [id], onDelete: SetNull)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([consumedAt])
  @@index([userId])
}

model CustomTarget {
  id        Int      @id @default(autoincrement())
  key       String
  label     String
  unit      String
  target    Float?
  allowOver Boolean  @default(false)
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, key])
  @@index([userId])
}

model User {
  id           Int        @id @default(autoincrement())
  username     String     @unique
  passwordHash String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  sessions     Session[]
  ingredients  Ingredient[]
  foods        Food[]
  recipes      Recipe[]
  logEntries   LogEntry[]
  customTargets CustomTarget[]
}

model Session {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
}
