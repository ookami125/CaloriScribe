generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Ingredient {
  id           Int                @id @default(autoincrement())
  name         String
  barcode      String?            @unique
  calories     Float
  protein      Float
  carbs        Float
  fat          Float
  unit         String
  servingSize         String?
  servingsPerContainer String?
  saturatedFat        Float?
  transFat            Float?
  cholesterolMg       Float?
  sodiumMg            Float?
  dietaryFiber        Float?
  totalSugars         Float?
  addedSugars         Float?
  vitaminDMcg         Float?
  calciumMg           Float?
  ironMg              Float?
  potassiumMg         Float?
  ingredientsList     String?
  vitamins            String?
  allergens           String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  recipeItems  RecipeIngredient[]
  logEntries   LogEntry[]
}

model Recipe {
  id         Int                @id @default(autoincrement())
  name       String
  notes      String?
  servings   Int                @default(1)
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt
  items      RecipeIngredient[]
  logEntries LogEntry[]
}

model RecipeIngredient {
  id           Int        @id @default(autoincrement())
  recipeId     Int
  ingredientId Int
  quantity     Float
  unit         String
  recipe       Recipe     @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Restrict)
}

model LogEntry {
  id           Int        @id @default(autoincrement())
  consumedAt   DateTime   @default(now())
  quantity     Float
  unit         String
  ingredientId Int?
  recipeId     Int?
  notes        String?
  createdAt    DateTime   @default(now())
  ingredient   Ingredient? @relation(fields: [ingredientId], references: [id], onDelete: SetNull)
  recipe       Recipe?     @relation(fields: [recipeId], references: [id], onDelete: SetNull)

  @@index([consumedAt])
}

model DailyTarget {
  id        Int      @id @default(autoincrement())
  calories  Float?
  protein   Float?
  carbs     Float?
  fat       Float?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
